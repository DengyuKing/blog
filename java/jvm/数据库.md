# 数据库

## 数据库索引
### 可用作数据库索引的数据结构
从数据库的发展历程来看，可用作数据库索引的数据结构可以是二叉树，hash，红黑树，B树和B+树，为什么Mysql单单选择用B+树用作数据库的索引呢？

*二叉树*作为数据库索引主要的缺点在于它在最坏的情况下，查找时间复杂度是O(N)，意味着查找一个数据，最坏的情况下需要把磁盘中的数据载入内存N次，这个开销是巨大的。

*hash表*，hash表作为一种查找时间复杂度为O(1)，在精确查找数据的场景下会有很高的性能，但是hash表有一个缺点是数据记录不连续，如果来个范围查找，则需要查数据N次。

*红黑树*作为一种平衡的二叉树，同时也拥有O(logN)的性能，但是当数据量很大的情况下，红黑树的深度会变得很大，这样对于查找数据同时也需要找多次，性能也不是很好。

*B树或B+树* B树可以看成是多叉树，可以考虑增加B树的度，从而在树的深度和容量之间做一个平衡。
B 树和B+树的区别

``` graphviz
digraph {
    node[shape =""]
}
```





---
## 数据库隔离级别（一种Sql所定义的规范，所有的数据库都要去实现这种隔离级别）

### 读未提交
    当前事务读取了其他事务未提交的数据，从而读到脏数据
### 读提交
    当前事务读取了其他事务已经提交的数据，当多次读时，多次读到的数据可能会不一致
### 重复读
    当前事务可以多次读取数据，且多次读取的数据是一致的，但是在范围读时，由于其他事务可能往某个范围内插入数据，则范围读的记录数是不一致的，从而发生幻读
    innodb中解决此事的办法是通过MVVC机制，在事务开始之前把要读的数据生成一个快照，从而避免了幻读。
### 串行（效率太差一般不用）

---
## MySQL锁
### 共享锁(锁的性质) 读锁
### 独占锁(锁的性质) 写锁

### recordLock(记录锁，锁的范围)
### next-key-lock 记录锁和gap锁的结合(锁的范围)


## innoDb
### 无锁一致性读


### 间隙锁（锁的一种性质，用于表名锁的范围）
间隙的概念(GAP) Mysql中间隙的概念是索引数据中可以插入数据的地方 它的作用范围是锁定一个范围比如 100-200的范围，任何在这个范围内的数据不能被插入，（但没有说不能被修改,需要确定）

### 插入意向锁



### unique index
### 
### mysql非唯一索引的结构

### mysql索引使用中的一些坑

 - 索引必须是独立的列，索引的列不能在表达式中，也不能作为作为函数的参数。

### 聚簇索引 无非就是把索引和数据存在一个文件里


